# Microcode

## Address bus

Length: 24 bit (3 byte)

```
* 23 OP/I  (CU)
* 22 PC/I  (PC)
* 21 PC/O  (PC)
* 20 +1    (PC)
* 19 AR/I  (RAM)
* 18 R     (RAM)
* 17 W     (RAM)
* 16 DR/I  (RAM)

* 15 DR/O  (RAM)
* 14 %     ()
* 13 %     ()
* 12 1     (ALU)
* 11 OP3   (ALU)
* 10 OP2   (ALU)
* 09 OP1   (ALU)
* 08 OP0   (ALU)

* 07 AX/I  (AX)
* 06 AX/O  (AX)
* 05 BX/I  (BX)
* 04 BX/O  (BX)
* 03 SP/I  (SP)
* 02 SP/O  (SP)
* 01 Z/I   (Z)
* 00 Z/O   (Z)
```

## Instructions

### fetch & decode cycle

```
$00 $280000 001010000000000000000000 AR := PC                 ; fetch
$01 $050000 000001010000000000000000 DR := {AR}
$02 $908000 100100001000000000000000 OP := DR & PC := PC+1
$03 $280000 001010000000000000000000 AR := PC                 ; fetch operands
$04 $150000 000101010000000000000000 DR := {AR} & PC := PC+1
$05 $ffffff 111111111111111111111111                          ; decode
```

### Storage

#### lda #$nn (imm)

```
$06 $008080 000000001000000010000000 AX := DR
$07 $000000 000000000000000000000000                          ; execute
```

#### lda $nn (abs)

```
$08 $088000 000010001000000000000000 AR := DR
$09 $050000 000001010000000000000000 DR := {AR}
$0a $008080 000000001000000010000000 AX := DR
$0b $000000 000000000000000000000000                          ; execute
```

#### ldb #$nn (imm)

```
$0c $008020 000000001000000000100000 BX := DR
$0d $000000 000000000000000000000000                          ; execute
```

#### ldb $nn (abs)

```
$0e $088000 000010001000000000000000 AR := DR
$0f $050000 000001010000000000000000 DR := {AR}
$10 $008020 000000001000000000100000 BX := DR
$11 $000000 000000000000000000000000                          ; execute
```

#### sta $nn (abs)

```
$12 $088000 000010001000000000000000 AR := DR
$13 $010040 000000010000000001000000 DR := AX
$14 $028000 000000101000000000000000 {AR} := DR
$15 $000000 000000000000000000000000                          ; execute
```

#### stb $nn,a (idx)

```
$16 $008002 000000001000000000000010 Z := DR + AX
$17 $080001 000010000000000000000001 AR := Z
$18 $010040 000000010000000001000000 DR := AX
$19 $028000 000000101000000000000000 {AR} := DR
$1a $000000 000000000000000000000000                          ; execute
```

#### stb $nn (abs)

```
$1b $088000 000010001000000000000000 AR := DR
$1c $010010 000000010000000000010000 DR := BX
$1d $028000 000000101000000000000000 {AR} := DR
$1e $000000 000000000000000000000000                          ; execute
```

#### tab

```
$1f $000060 000000000000000001100000 BX := AX
$20 $000000 000000000000000000000000                          ; execute
```

#### tba

```
$21 $000090 000000000000000010010000 AX := BX
$22 $000000 000000000000000000000000                          ; execute
```

### Math

#### adc #$nn (imm)

```
$23 $008002 000000001000000000000010 Z := AX + DR
$24 $000081 000000000000000010000001 AX := Z
$25 $000000 000000000000000000000000                          ; execute
```

#### adc $nn (abs)

```
$26 $088000 000010001000000000000000 AR := DR
$27 $050000 000001010000000000000000 DR := {AR}
$28 $008002 000000001000000000000010 Z := AX + DR
$29 $000081 000000000000000010000001 AX := Z
$2a $000000 000000000000000000000000                          ; execute
```

#### sbc #$nn (imm)

```
$2b $008102 000000001000000100000010 Z := AX - DR
$2c $000081 000000000000000010000001 AX := Z
$2d $000000 000000000000000000000000                          ; execute
```

#### sbc $nn (abs)

```
$2e $088000 000010001000000000000000 AR := DR
$2f $050000 000001010000000000000000 DR := {AR}
$30 $008102 000000001000000100000010 Z := AX - DR
$31 $000081 000000000000000010000001 AX := Z
$32 $000000 000000000000000000000000                          ; execute
```

#### inc

```
$33 $001002 000000000001000000000010 Z := AX + 1
$34 $000081 000000000000000010000001 AX := Z
$35 $000000 000000000000000000000000                          ; execute
```

#### dec

```
$36 $001102 000000000001000100000010 Z := AX - 1
$37 $000081 000000000000000010000001 AX := Z
$38 $000000 000000000000000000000000                          ; execute
```
